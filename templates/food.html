{% extends "base.html" %}

{% block content %}
<main class="max-w-7xl mx-auto px-4 sm:px-6 lg:px-8 py-10">
    <h1 class="text-4xl font-bold text-gray-900 mb-6 text-center">Our Delicious Menu</h1>
    
    {% set cart_item_count = cart | length %}
    <div class="text-center mb-6">
        <p class="text-lg font-medium text-gray-700">ðŸ›’ Items in Cart: <span class="text-red-700 font-extrabold">{{ cart_item_count }}</span></p>
    </div>

    <div class="flex justify-center mb-10">
        <input type="text" id="search-input" placeholder="Search for food items..."
               class="w-full max-w-lg p-3 border border-gray-300 rounded-lg shadow-sm focus:ring-red-500 focus:border-red-500 text-lg"
               onkeyup="filterFoodItems()">
    </div>
    
    <div id="product-grid" class="grid grid-cols-1 sm:grid-cols-2 md:grid-cols-3 lg:grid-cols-4 gap-8">
        {% for food in foods %}
        {% set item_in_cart = cart.get(food.id | string) %}
        <div class="product-card bg-white rounded-xl shadow-xl overflow-hidden flex flex-col transition-all duration-300 transform hover:scale-[1.02] hover:shadow-2xl border border-gray-100"
             data-name="{{ food.name.lower() }}">
            <img src="{{ url_for('uploaded_file', filename=food.image) if food.image else 'https://placehold.co/400x300/a30000/ffffff?text=' + food.name|replace(' ', '+') }}" alt="{{ food.name }}" 
          class="w-full h-48 object-cover object-center" 
          onerror="this.onerror=null;this.src='https://placehold.co/400x300/a30000/ffffff?text=Image+Missing'">
            
            <div class="p-5 flex flex-col flex-grow">
                <h2 class="text-xl font-bold text-gray-900 mb-2">{{ food.name }}</h2>
                <p class="text-sm text-gray-600 mb-4 flex-grow line-clamp-2">{{ food.description or 'A delightful dish prepared fresh daily.' }}</p>
                
                <div class="pt-2 border-t border-gray-100">
                    <div class="flex justify-between items-center mb-3">
                        <span class="text-2xl font-extrabold text-red-800">â‚¹{{ food.price | round(2) }}/-</span>
                        {% if item_in_cart %}
                        <span class="text-lg font-bold text-green-600 border border-green-600 px-2 rounded-full">Qty: {{ item_in_cart.quantity }}</span>
                        {% endif %}
                    </div>

                    <form action="{{ url_for('food') }}" method="POST" class="hidden" 
                          onsubmit="document.getElementById('q{{ food.id }}').value = document.getElementById('qty-{{ food.id }}').value;">
                        <input type="hidden" name="food_name" value="{{ food.name }}">
                        <input type="hidden" name="price" value="{{ food.price }}">
                        <input type="hidden" id="q{{ food.id }}" name="quantity" value="1">
                    </form>

                    <div class="flex space-x-2 justify-end">
                        {% if not item_in_cart %}
                        <a href="{{ url_for('add_to_cart', food_id=food.id) }}" 
                           class="secondary-btn bg-gray-200 text-gray-800 text-sm font-semibold px-4 py-2 rounded-full flex items-center shadow-md transition-colors duration-200 hover:bg-gray-300">
                             Add to Cart
                        </a>
                        <a href="{{ url_for('order_item', food_id=food.id) }}" 
                             class="primary-btn text-white text-sm font-semibold px-4 py-2 rounded-full flex items-center shadow-md bg-red-600 hover:bg-red-700">
                            Order Now
                        </a>
                        {% else %}
                        <a href="{{ url_for('remove_from_cart', food_id=food.id) }}" 
                           class="secondary-btn bg-red-100 text-red-700 text-sm font-semibold px-4 py-2 rounded-full flex items-center shadow-md transition-colors duration-200 hover:bg-red-200">
                             Remove
                        </a>
                        <a href="{{ url_for('order_item', food_id=food.id) }}" 
                           class="primary-btn text-white text-sm font-semibold px-4 py-2 rounded-full flex items-center shadow-md bg-green-600 hover:bg-green-700">
                             Order Now
                        </a>
                        {% endif %}
                    </div>
                </div>
            </div>
        </div>
        {% endfor %}
    </div>
</main>

<script>
    function filterFoodItems() {
        // Get the search term and convert to lowercase for case-insensitive search
        const searchTerm = document.getElementById('search-input').value.toLowerCase();
        // Get all food item cards
        const foodCards = document.querySelectorAll('.product-card');

        foodCards.forEach(card => {
            // Get the food name from the data-name attribute
            const foodName = card.getAttribute('data-name');
            
            // Check if the food name includes the search term
            if (foodName.includes(searchTerm)) {
                // Show the card (make sure it's visible)
                card.style.display = 'flex'; // Use 'flex' because your original card style is 'flex flex-col'
            } else {
                // Hide the card
                card.style.display = 'none';
            }
        });
    }
</script>
{% endblock %}